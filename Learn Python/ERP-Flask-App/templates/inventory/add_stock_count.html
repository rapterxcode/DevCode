{% extends "base.html" %}

{% block title %}Add Stock Count - ERP System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Add Stock Count</h1>
    <a href="{{ url_for('stock_count') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to List
    </a>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="count_type" class="form-label">Count Type / ประเภทการนับ</label>
                    <select class="form-select" id="count_type" name="count_type" required>
                        <option value="">Select Count Type / เลือกประเภทการนับ</option>
                        <option value="full">Full Count / นับทั้งหมด</option>
                        <option value="cycle">Cycle Count / นับตามรอบ</option>
                        <option value="spot">Spot Count / นับจุด</option>
                    </select>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="count_date" class="form-label">Count Date / วันที่นับ</label>
                    <input type="date" class="form-control" id="count_date" name="count_date" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="counted_by" class="form-label">Counted By / ผู้นับ</label>
                    <input type="text" class="form-control" id="counted_by" name="counted_by" 
                           placeholder="Enter counter name / ใส่ชื่อผู้นับ">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="status" class="form-label">Status / สถานะ</label>
                    <select class="form-select" id="status" name="status" required>
                        <option value="draft">Draft / ร่าง</option>
                        <option value="counting">Counting / กำลังนับ</option>
                        <option value="completed">Completed / เสร็จสิ้น</option>
                    </select>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="notes" class="form-label">Notes / หมายเหตุ</label>
                <textarea class="form-control" id="notes" name="notes" rows="3" 
                          placeholder="Enter any notes / ใส่หมายเหตุ"></textarea>
            </div>
            
            <!-- Product Selection -->
            <h5 class="mb-3">Products to Count / สินค้าที่จะนับ</h5>
            <div id="product-items">
                <div class="row product-item mb-2">
                    <div class="col-md-4">
                        <select class="form-select" name="product_id[]" required>
                            <option value="">Select Product / เลือกสินค้า</option>
                            {% for product in products %}
                            <option value="{{ product.id }}">{{ product.name }} ({{ product.sku }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <input type="number" class="form-control" name="expected_quantity[]" 
                               placeholder="Expected / คาดการณ์" min="0" step="0.01">
                    </div>
                    <div class="col-md-2">
                        <input type="number" class="form-control" name="actual_quantity[]" 
                               placeholder="Actual / จริง" min="0" step="0.01" required>
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" name="location[]" 
                               placeholder="Location / ตำแหน่ง">
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-outline-danger remove-item">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <button type="button" class="btn btn-outline-primary mb-3" id="add-item">
                <i class="fas fa-plus me-2"></i>Add Item / เพิ่มรายการ
            </button>
            
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-secondary me-2" onclick="history.back()">Cancel / ยกเลิก</button>
                <button type="submit" class="btn btn-primary">Save Count / บันทึกการนับ</button>
            </div>
        </form>
    </div>
</div>

<script>
document.getElementById('add-item').addEventListener('click', function() {
    const container = document.getElementById('product-items');
    const firstItem = container.querySelector('.product-item');
    const newItem = firstItem.cloneNode(true);
    
    // Clear input values
    newItem.querySelectorAll('input, select').forEach(input => {
        input.value = '';
    });
    
    container.appendChild(newItem);
    
    // Add remove functionality
    newItem.querySelector('.remove-item').addEventListener('click', function() {
        if (container.children.length > 1) {
            newItem.remove();
        }
    });
});

// Add remove functionality to existing items
document.querySelectorAll('.remove-item').forEach(button => {
    button.addEventListener('click', function() {
        const container = document.getElementById('product-items');
        if (container.children.length > 1) {
            button.closest('.product-item').remove();
        }
    });
});

// Set today's date as default
document.getElementById('count_date').valueAsDate = new Date();
</script>
{% endblock %}